(Si lo guarda en GitHub, la extensión `.md` con la etiqueta ```mermaid mostrará el diagrama.)

---

# 3) `docker-compose.yml`

Guarde como `docker-compose.yml`:

```yaml
version: '3.8'
services:
  postgres:
    image: postgres:15
    restart: unless-stopped
    environment:
      POSTGRES_USER: comarcadev
      POSTGRES_PASSWORD: changeme
      POSTGRES_DB: comarcaventas
    volumes:
      - db_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7
    ports:
      - "6379:6379"

  backend:
    build: ./backend
    command: npm run start:dev
    volumes:
      - ./backend:/usr/src/app
    ports:
      - "3000:3000"
    environment:
      DATABASE_URL: postgres://comarcadev:changeme@postgres:5432/comarcaventas
      REDIS_URL: redis://redis:6379

  app:
    build: ./app
    command: npm start
    volumes:
      - ./app:/usr/src/app
    ports:
      - "19000:19000"
volumes:
  db_data:
```mermaid
erDiagram
    USERS ||--o{ PRODUCTS : sells
    USERS ||--o{ ORDERS : places
    PRODUCTS ||--o{ PRODUCT_IMAGES : has
    ORDERS ||--o{ ORDER_ITEMS : contains
    ORDER_ITEMS }o--|| PRODUCTS : references
    CHATS ||--o{ MESSAGES : contains
    USERS ||--o{ CHATS : participates
    USERS ||--o{ FAVORITES : favorites
    PRODUCTS ||--o{ FAVORITES : favorited_by

    USERS {
        uuid id PK
        string name
        string email
        string phone
        string password_hash
        string role
        timestamp created_at
    }
    PRODUCTS {
        uuid id PK
        uuid seller_id FK
        string title
        text description
        int price_cents
        string currency
        int stock
        string condition
        uuid category_id FK
        timestamptz published_at
    }
    PRODUCT_IMAGES {
        uuid id PK
        uuid product_id FK
        string url
        int order_index
    }
    ORDERS {
        uuid id PK
        uuid buyer_id FK
        int total_cents
        string currency
        string status
        json shipping_info
        timestamptz created_at
    }
    ORDER_ITEMS {
        uuid id PK
        uuid order_id FK
        uuid product_id FK
        int qty
        int unit_price_cents
    }
    CHATS {
        uuid id PK
        uuid product_id FK
        uuid buyer_id FK
        uuid seller_id FK
        timestamptz last_message_at
    }
    MESSAGES {
        uuid id PK
        uuid chat_id FK
        uuid sender_id FK
        text content
        json attachments
        timestamptz created_at
    }
    FAVORITES {
        uuid id PK
        uuid user_id FK
        uuid product_id FK
        timestamptz created_at
    }
# 1) Ver contenido de docker-compose
cat Docker-compose.yml > salida_docker.txt

# 2) Sacar package.json del backend y frontend (si existen)
cat Backend/package.json > salida_backend_pkg.json || true
cat "Frontend react Native/package.json" > salida_frontend_pkg.json || true

# 3) Auditoría rápida de dependencias (si tiene node)
# Backend
cd Backend && npm install --legacy-peer-deps >/dev/null 2> errores_backend_npm.txt || true
npm audit --json > salida_backend_audit.json || true
cd ..

# Frontend
cd "Frontend react Native" && npm install --legacy-peer-deps >/dev/null 2> errores_frontend_npm.txt || true
npm audit --json > salida_frontend_audit.json || true
cd ..
services:
   backend:
     build: ./Backend
     container_name: backend
     ports:
       - "3000:3000"

-    environment:
-      DB_PASSWORD: "1234"
+    env_file:
+      - ./Backend/.env

-    user: root
+    user: "node"

+    security_opt:
+      - no-new-privileges:true
